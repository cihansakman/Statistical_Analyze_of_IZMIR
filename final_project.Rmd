---
title: "Final Project"
author: "Cihan"
date: "14 05 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# **R Final Project**

> The scope of this project is the enviromental analyze of Izmir from the three datasets generated by the Izmir Municipality (IBB Acik Veri
Portali https://acikveri.bizizmir.com/dataset). In this project we will try to analyze the Water Consumption and Production and The Amount of Food Distriubted for the Animals.

***

## Imports
```{r}
library(ggplot2)
library('stringr')
library(dplyr)

```

***

### Loading Dataset
```{r}
water.consumption <- read.csv("C:\\Users\\sakma\\Desktop\\R Files\\Final Project\\csv_files\\yillik-mahalle-su-tuketimi.csv", header = TRUE, encoding="UTF-8", stringsAsFactors=FALSE,sep=";")

animal.food <- read.csv("C:\\Users\\sakma\\Desktop\\R Files\\Final Project\\csv_files\\dagitilan-mama-miktari.csv", header = TRUE, encoding="UTF-8", stringsAsFactors=FALSE, sep=";")

water.production <- read.csv("C:\\Users\\sakma\\Desktop\\R Files\\Final Project\\csv_files\\su-uretimi-kaynak-dagilimi.csv", header = TRUE, encoding="UTF-8", stringsAsFactors=FALSE,sep=";")
```

***

Change the column names
```{r}
colnames(water.consumption) <- c("year","month","district","neighborhood","user_count","avg_consumption")
colnames(water.production) <- c("year","month","source","amount_m3")
colnames(animal.food) <- c("year","month","district","neighborhood","distributor","count","unit")


```

### **Data visualization and descriptive stats**

> Let's see some of data
```{r echo=FALSE}
paste("Water Consumption")
head(water.consumption, 10)
paste("Water Production")
head(water.production, 10)
paste("Animal Food")
head(animal.food, 10)
```

>- Summiraze all three data
```{r echo=FALSE}
paste("Summary of Water Consumption")
summary(water.consumption)
paste("Summary of Water Production")
summary(water.production)
paste("Summary of Animal Food")
summary(animal.food)

```


>There are some mistakes in the data.

1. In **Water Consumption**, *'year'* and *'month'* columns' type should be String, *'avg_consumpiton'* column kept as String and numbers are seperated by **','**. We'll replace these ',' with '.' and convert the type into **float**.

2. In **Water Production**, *'year'* and *'month'* columns' type should be String, *'amount_m3* should kept as **float**.

3. In **Animal Food**, *'year'* and *'month'* columns' type should be String.

```{r echo=TRUE}

water.consumption$avg_consumption <- str_replace_all(water.consumption$avg_consumption , ',', '.')

paste("Edit for Water Consumption")
water.consumption$avg_consumption = as.numeric(as.character(water.consumption$avg_consumption))
water.consumption$year = as.character(as.numeric(water.consumption$year))
water.consumption$month = as.character(as.numeric(water.consumption$month))
paste("Types of Features in Water Consumption after Edit")
sapply(water.consumption, mode)

paste("Edit for Water Production")
water.production$amount_m3 = as.numeric(as.character(water.production$amount_m3))
water.production$year = as.character(as.numeric(water.production$year))
water.production$month = as.character(as.numeric(water.production$month))
paste("Types of Features in Water Production after Edit")
sapply(water.production, mode)

paste("Edit for Animal Food")
animal.food$year = as.character(as.numeric(animal.food$year))
animal.food$month = as.character(as.numeric(animal.food$month))
paste("Types of Features in Water Animal Food after Edit")
sapply(animal.food, mode)


```



### Let's take the Water Consumption of 2020 and show the most 5 consumer districts in Izmir
- Subset the values which are belong the 2020 and summarize the data.
- Create a new feature that refers total consumption rather than average consumption
**Note:** Due to values are huge for total consumption we'll take the m^3/10^3
```{r message = FALSE, warning=FALSE}
consumption.2020 = subset(water.consumption, subset = water.consumption$year == 2020)
#Created a new feature called consumption which refers total consumption
consumption.2020$consumption_in_month <- paste((consumption.2020$avg_consumption * consumption.2020$user_count) / 10**3 )
consumption.2020$consumption_in_month = as.numeric(as.character(consumption.2020$consumption_in_month))
head(consumption.2020,10)
summary(consumption.2020)
```


- Show the most consumer districts and plot them
```{r  message = FALSE, warning=FALSE}
#We can see the most consumer districts in 2020 in Izmir.
df <- consumption.2020 %>% 
  group_by(district) %>% 
  summarize(total_consumption = sum(consumption_in_month))

df <- df %>%
  arrange(desc(total_consumption))

df %>% tbl_df %>% print(n=40)

df <- df %>% slice_max(total_consumption, n = 5)

p<-ggplot(data=df, aes(x=reorder(district, -total_consumption), y=total_consumption)) +
  geom_bar(stat="identity", fill="orange")

p + labs(title = "Most 5 Consumer Districts", x='District', y='Total Consumption(m^3/10^3)')

```

### Let's take the most two consumer in 2020 and compare them(Buca and Karabağlar)
```{r  message = FALSE, warning=FALSE}
top.two.consumer = subset(consumption.2020, subset = consumption.2020$district == "BUCA" | consumption.2020$district == "KARABAĞLAR" )
summary(top.two.consumer)
## Be sure about taking the Buca and Karabağlar
unique(top.two.consumer[c("district")])
```

- Let's see how many neighborhoods does districts have 
```{r  message = FALSE, warning=FALSE}
p <- top.two.consumer %>% 
     group_by(district) %>% 
     summarise(n=n_distinct(neighborhood)) %>%
     ggplot(., aes(x=district, y=n)) +
            geom_bar(stat='identity',fill="#d896ff")


p + labs(title = "Count of Neighborhoods for Districts", x='District', y='Count of Neighborhoods')
```

**Note:** It seems that Buca has less neighborhoods but the water consuming in Buca higher than Karabağlar.

- Let's see the mean water consumption for each month 


```{r  message = FALSE, warning=FALSE, echo=FALSE}
top.two.consumer$month = as.numeric(as.character(top.two.consumer$month))
summary_data <- tapply(top.two.consumer$consumption_in_month, list(months = top.two.consumer$month,
                                       districts = top.two.consumer$district),
                       FUN = mean, na.rm = TRUE)
summary_data

```
